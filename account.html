<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Your Account — Securable SSI</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.css" rel="stylesheet">
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>

<style>
    :root {
        --bg: #f8fafc;
        --text: #0f172a;
        --subtle: #64748b;
        --card: #ffffff;
        --border: #e2e8f0;
        --primary: #2563eb;
        --primary-hover: #1e40af;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0;
        font-family: 'Inter', sans-serif;
        background: var(--bg);
        color: var(--text);
    }

    /* HEADER (same as other pages) */
    header {
        padding: 18px 40px;
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 50;
    }

    .logo { font-size: 22px; font-weight: 700; }

    .header-right {
        display: flex;
        align-items: center;
        gap: 24px;
        position: relative;
    }

    .nav-links {
        display: flex;
        gap: 20px;
    }

    .nav-links a {
        text-decoration: none;
        color: var(--text);
        font-size: 15px;
        font-weight: 500;
        opacity: .8;
        transition: .2s;
    }
    .nav-links a:hover { opacity: 1; }

    .login-btn {
        padding: 9px 16px;
        border-radius: 999px;
        background: var(--primary);
        color: #fff;
        font-size: 14px;
        text-decoration: none;
        transition: .2s;
    }
    .login-btn:hover { background: var(--primary-hover); }

    .profile-btn {
        width: 40px; height: 40px;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid var(--border);
    }
    .profile-btn img {
        width: 100%; height: 100%; object-fit: cover;
    }

    .profile-menu {
        position: absolute;
        top: 56px; right: 0;
        background: #fff;
        border-radius: 12px;
        border: 1px solid var(--border);
        width: 200px;
        display: none;
        overflow: hidden;
        box-shadow: 0 8px 28px rgba(0,0,0,0.12);
    }

    .profile-menu-header {
        padding: 12px 14px;
        font-size: 13px;
        color: var(--subtle);
        border-bottom: 1px solid var(--border);
    }

    .profile-menu a {
        display: block;
        padding: 11px 16px;
        text-decoration: none;
        font-size: 14px;
        color: var(--text);
        border-bottom: 1px solid var(--border);
    }
    .profile-menu a:hover { background: #f1f5f9; }
    .profile-menu a:last-child { border-bottom: none; color: #dc2626; }

    /* MAIN */
    main {
        max-width: 750px;
        margin: 80px auto;
        padding: 0 20px;
    }

    #notLoggedInBox {
        text-align: center;
        background: #fff;
        padding: 60px 20px;
        border-radius: 18px;
        border: 1px dashed var(--border);
    }

    #notLoggedInBox h2 { font-size: 28px; margin-bottom: 12px; }
    #notLoggedInBox p { color: var(--subtle); margin-bottom: 22px; }

    .btn-row {
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .btn-sec {
        padding: 11px 22px;
        border-radius: 999px;
        border: 1px solid var(--border);
        text-decoration: none;
        font-size: 14px;
        color: var(--text);
        transition: .2s;
    }
    .btn-sec:hover { background: #f8fafc; }

    /* ACCOUNT BOX */
    #accountBox {
        display: none;
        background: #fff;
        padding: 30px;
        border-radius: 20px;
        border: 1px solid var(--border);
        box-shadow: 0 8px 30px rgba(0,0,0,0.06);
    }

    .account-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 26px;
    }

    .acc-avatar {
        width: 65px; height: 65px;
        border-radius: 50%;
        overflow: hidden;
    }
    .acc-avatar img {
        width: 100%; height: 100%; object-fit: cover;
    }

    .acc-name { font-size: 20px; font-weight: 700; }
    .acc-email { font-size: 14px; color: var(--subtle); }

    .acc-section {
        margin-top: 30px;
        padding-top: 18px;
        border-top: 1px solid var(--border);
    }

    .acc-section h3 {
        margin-bottom: 12px;
        font-size: 16px;
    }

    .acc-item {
        font-size: 14px;
        color: var(--subtle);
        margin-bottom: 6px;
    }

    .acc-actions {
        margin-top: 26px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .btn-primary {
        padding: 11px 22px;
        border-radius: 999px;
        background: var(--primary);
        color: white;
        text-decoration: none;
        font-size: 14px;
        transition: .2s;
    }
    .btn-primary:hover { background: var(--primary-hover); }
</style>
</head>

<body>

<header>
    <div class="logo">Securable Foundation</div>

    <div class="header-right">
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="portals.html">Portals</a>
            <a href="#">Docs</a>
        </nav>

        <a id="loginBtn" class="login-btn" href="#">Login</a>

        <div id="profileBtn" class="profile-btn" style="display:none;">
            <img id="profileImg">
        </div>

        <div id="profileMenu" class="profile-menu">
            <div class="profile-menu-header" id="profileMenuHeader">Signed in</div>
            <a href="portals.html">My Portals</a>
            <a href="account.html">Account</a>
            <a href="#" id="logoutBtn">Logout</a>
        </div>
    </div>
</header>

<main>
    <!-- NOT LOGGED IN -->
    <div id="notLoggedInBox">
        <h2>You’re not supposed to be here.</h2>
        <p>This page requires a verified Securable SSI identity.</p>
        <div class="btn-row">
            <a href="index.html" class="btn-sec">← Return Home</a>
            <a href="#" id="loginAlt" class="btn-sec">Login</a>
        </div>
    </div>

    <!-- LOGGED IN ACCOUNT BOX -->
    <div id="accountBox">
        <div class="account-header">
            <div class="acc-avatar">
                <img id="accAvatar">
            </div>
            <div>
                <div class="acc-name" id="accName"></div>
                <div class="acc-email" id="accEmail"></div>
            </div>
        </div>

        <div class="acc-section">
            <h3>Identity Details</h3>
            <div class="acc-item">User ID: <span id="accUserId"></span></div>
            <div class="acc-item">Provider: <span id="accProvider"></span></div>
            <div class="acc-item">Last Login: <span id="accLastLogin"></span></div>
        </div>

        <div class="acc-actions">
            <a class="btn-primary" href="https://dev-tnhr6w3ixu052ugm.us.auth0.com/u/login/" target="_blank">
                Manage Account
            </a>
            <a class="btn-primary" href="portals.html">Go to Portals</a>
            <a class="btn-sec" href="#" id="logoutBtn2">Logout</a>
        </div>
    </div>
</main>

<script>
(async () => {
    const auth0Client = await auth0.createAuth0Client({
        domain: "dev-tnhr6w3ixu052ugm.us.auth0.com",
        clientId: "cOgHvMFU7i0MqNbV6tHisyUwiMD7tJka",
        cacheLocation: "localstorage",
        authorizationParams: { redirect_uri: window.location.href }
    });

    // Redirect handling
    if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
        await auth0Client.handleRedirectCallback();
        history.replaceState({}, document.title, window.location.pathname);
    }

    const isAuth = await auth0Client.isAuthenticated();

    // ELEMENTS
    const loginBtn = document.getElementById("loginBtn");
    const loginAlt = document.getElementById("loginAlt");
    const profileBtn = document.getElementById("profileBtn");
    const profileImg = document.getElementById("profileImg");
    const profileMenu = document.getElementById("profileMenu");
    const profileMenuHeader = document.getElementById("profileMenuHeader");
    const logoutBtn = document.getElementById("logoutBtn");
    const logoutBtn2 = document.getElementById("logoutBtn2");

    const notLoggedInBox = document.getElementById("notLoggedInBox");
    const accountBox = document.getElementById("accountBox");

    const accAvatar = document.getElementById("accAvatar");
    const accName = document.getElementById("accName");
    const accEmail = document.getElementById("accEmail");
    const accUserId = document.getElementById("accUserId");
    const accProvider = document.getElementById("accProvider");
    const accLastLogin = document.getElementById("accLastLogin");

    const login = (e) => {
        e?.preventDefault();
        auth0Client.loginWithRedirect();
    };

    loginBtn.onclick = login;
    loginAlt.onclick = login;

    if (!isAuth) return;

    // LOGGED IN
    const user = await auth0Client.getUser();

    // Hide error box, show account
    notLoggedInBox.style.display = "none";
    accountBox.style.display = "block";

    // Header avatar
    loginBtn.style.display = "none";
    profileBtn.style.display = "block";
    profileImg.src = user.picture;

    profileMenuHeader.textContent = user.name || user.email;

    profileBtn.onclick = () => {
        profileMenu.style.display =
            profileMenu.style.display === "block" ? "none" : "block";
    };

    document.addEventListener("click", (e) => {
        if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.style.display = "none";
        }
    });

    const logOut = (e) => {
        e.preventDefault();
        auth0Client.logout({
            logoutParams: { returnTo: window.location.origin }
        });
    };

    logoutBtn.onclick = logOut;
    logoutBtn2.onclick = logOut;

    // Fill account details
    accAvatar.src = user.picture;
    accName.textContent = user.name || "Unknown User";
    accEmail.textContent = user.email || "No email";

    accUserId.textContent = user.sub;
    accProvider.textContent = user.sub.split("|")[0].toUpperCase();
    accLastLogin.textContent = new Date().toLocaleString();
})();
</script>

</body>
</html>
